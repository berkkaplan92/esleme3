<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Pika & Berk – V23.2 (Görsel düzen uygulanmış)</title>
<style>
:root{
  --card-w:170px;
  --card-h:220px;
}
*{box-sizing:border-box;}
body{
  margin:0; height:100vh; overflow:hidden;
  background:linear-gradient(to bottom right,#b3e5fc,#e1f5fe);
  font-family:"Comic Sans MS",system-ui,sans-serif;
}

/* Yönerge kutusu (sol üst) */
#instructionBox{
  position:absolute; top:40px; left:40px;
  background:#e3f2fd; border:3px solid #2196f3; border-radius:14px;
  padding:10px 14px; box-shadow:0 3px 8px rgba(0,0,0,.12);
  z-index:20; min-width:240px; color:#0d47a1;
}
#instructionBox .title{font-weight:700; margin-bottom:4px;}
#instructionBox .line{font-weight:700; font-size:13px; text-transform:uppercase; margin:1px 0;}

/* Üstteki 3 seçenek kart (biraz yukarı ve birbirine yakın) */
.option-card{
  width:var(--card-w); height:var(--card-h);
  background:#fff; border:3px solid rgba(11,132,165,.4); border-radius:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
  position:absolute; display:flex; flex-direction:column; align-items:center;
  padding:6px 8px; user-select:none; z-index:10;
  transition:transform .25s ease, border-color .2s ease, box-shadow .2s ease;
}
#optionLeft{   top:6%; left:24%;}
#optionCenter{ top:6%; left:50%; transform:translateX(-50%);}
#optionRight{  top:6%; right:24%;}

.card-tr{ margin-top:2px; font-weight:800; text-transform:uppercase; text-align:center; font-size:14px;}
.card-img{ width:120px; height:120px; object-fit:contain; margin:6px 0; pointer-events:none;}
.card-en{ font-size:12px; font-style:italic; text-align:center; opacity:.85; margin-bottom:2px;}

/* Alt, sürüklenen kart (biraz aşağı) */
#dragCard{
  width:var(--card-w); height:var(--card-h);
  background:#fff; border:3px solid rgba(11,132,165,.6); border-radius:16px;
  box-shadow:0 6px 10px rgba(0,0,0,.35);
  position:absolute; bottom:7%; left:50%; transform:translateX(-50%);
  display:flex; flex-direction:column; align-items:center;
  padding:6px 8px; cursor:grab; user-select:none; touch-action:none; z-index:200;
  transition:box-shadow .15s ease, border-color .15s ease;
}
.correct{ border-color:#2ecc71!important; box-shadow:0 0 18px rgba(46,204,113,.9)!important;}
.wrong{   border-color:#e74c3c!important; box-shadow:0 0 18px rgba(231,76,60,.9)!important;}

/* Sembol bar (en alta yakın) */
#symbolBar{
  position:absolute; bottom:2%; left:50%; transform:translateX(-50%);
  display:flex; gap:6px; background:rgba(255,255,255,.6);
  padding:6px 10px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.15); z-index:120;
}
.bar-slot{
  width:22px; height:22px; border-radius:6px; display:flex; align-items:center; justify-content:center;
  font-size:16px; background:#fff; transition:opacity .25s ease, transform .25s ease;
}
.bar-slot.empty{ opacity:.25; transform:scale(.9);}

/* Sağ alttaki sembol tahtası (değişmedi) */
#symbolBoard{
  position:absolute; bottom:20px; right:20px; width:270px; height:120px;
  background:url('https://cdn.pixabay.com/photo/2014/04/02/10/56/wood-306955_1280.png') center/cover no-repeat;
  border-radius:16px; display:flex; flex-wrap:wrap; justify-content:center; align-items:center;
  gap:6px; padding:10px; box-shadow:0 4px 10px rgba(0,0,0,.25);
}
.slot{
  width:30px; height:30px; border-radius:8px; background:rgba(255,255,255,.25);
  text-align:center; line-height:30px; font-size:22px; opacity:.25; transition:all .25s ease; cursor:pointer;
}
.slot.active{ opacity:1; transform:scale(1.06);}

/* Uçan sembol */
#flyStar{
  position:absolute; width:40px; height:40px; background:gold; border-radius:50%;
  box-shadow:0 0 12px rgba(255,215,0,.9); top:50%; left:50%;
  transform:translate(-50%,-50%) scale(0); opacity:0; pointer-events:none; z-index:999; transition:all .35s ease;
}
</style>
</head>
<body>

<!-- Yönerge -->
<div id="instructionBox">
  <div class="title">YÖNERGE :</div>
  <div class="line">- EŞLE</div>
  <div class="line">- AYNI OLANI EŞLE</div>
  <div class="line" id="line3">- ELMAYI EŞLE</div>
</div>

<!-- Üstteki 3 seçenek -->
<div class="option-card" id="optionLeft">
  <div class="card-tr" id="leftTr"></div>
  <img class="card-img" id="leftImg" alt="">
  <div class="card-en" id="leftEn"></div>
</div>
<div class="option-card" id="optionCenter">
  <div class="card-tr" id="centerTr"></div>
  <img class="card-img" id="centerImg" alt="">
  <div class="card-en" id="centerEn"></div>
</div>
<div class="option-card" id="optionRight">
  <div class="card-tr" id="rightTr"></div>
  <img class="card-img" id="rightImg" alt="">
  <div class="card-en" id="rightEn"></div>
</div>

<!-- Alt sürüklenen kart -->
<div id="dragCard">
  <div class="card-tr" id="dragTr"></div>
  <img class="card-img" id="dragImg" alt="">
  <div class="card-en" id="dragEn"></div>
</div>

<!-- Sembol bar -->
<div id="symbolBar">
  <div class="bar-slot" id="b1">⭐</div><div class="bar-slot" id="b2">⭐</div>
  <div class="bar-slot" id="b3">⭐</div><div class="bar-slot" id="b4">⭐</div>
  <div class="bar-slot" id="b5">⭐</div><div class="bar-slot" id="b6">⭐</div>
  <div class="bar-slot" id="b7">⭐</div><div class="bar-slot" id="b8">⭐</div>
</div>

<!-- Sembol tahtası -->
<div id="symbolBoard">
  <div class="slot" id="s1"></div><div class="slot" id="s2"></div><div class="slot" id="s3"></div><div class="slot" id="s4"></div>
  <div class="slot" id="s5"></div><div class="slot" id="s6"></div><div class="slot" id="s7"></div><div class="slot" id="s8"></div>
</div>

<!-- Uçan ⭐ -->
<div id="flyStar"></div>

<script>
/* =========================
   V23.2 – FULL MEKANİKLER
   (Sadece görsel konumlar değiştirildi)
   ========================= */

/* --- 50 NESNE (id = dosya adı) --- */
const ITEMS = [
  // Meyveler
  {id:"elma",tr:"Elma",en:"Apple"},
  {id:"muz",tr:"Muz",en:"Banana"},
  {id:"armut",tr:"Armut",en:"Pear"},
  {id:"uzum",tr:"Üzüm",en:"Grapes"},
  {id:"ananas",tr:"Ananas",en:"Pineapple"},
  {id:"cilek",tr:"Çilek",en:"Strawberry"},
  {id:"karpuz",tr:"Karpuz",en:"Watermelon"},
  {id:"kavun",tr:"Kavun",en:"Melon"},
  {id:"portakal",tr:"Portakal",en:"Orange"},
  {id:"kivi",tr:"Kivi",en:"Kiwi"},
  // Sebzeler
  {id:"domates",tr:"Domates",en:"Tomato"},
  {id:"salatalik",tr:"Salatalık",en:"Cucumber"},
  {id:"biber",tr:"Biber",en:"Pepper"},
  {id:"sarimsak",tr:"Sarımsak",en:"Garlic"},
  {id:"sogan",tr:"Soğan",en:"Onion"},
  {id:"brokoli",tr:"Brokoli",en:"Broccoli"},
  {id:"havuc",tr:"Havuç",en:"Carrot"},
  {id:"lahana",tr:"Lahana",en:"Cabbage"},
  {id:"misir",tr:"Mısır",en:"Corn"},
  {id:"patlican",tr:"Patlıcan",en:"Eggplant"},
  // Taşıtlar
  {id:"kamyon",tr:"Kamyon",en:"Truck"},
  {id:"araba",tr:"Araba",en:"Car"},
  {id:"motosiklet",tr:"Motosiklet",en:"Motorcycle"},
  {id:"bisiklet",tr:"Bisiklet",en:"Bicycle"},
  {id:"gemi",tr:"Gemi",en:"Ship"},
  {id:"helikopter",tr:"Helikopter",en:"Helicopter"},
  {id:"ucak",tr:"Uçak",en:"Plane"},
  {id:"tren",tr:"Tren",en:"Train"},
  {id:"otobus",tr:"Otobüs",en:"Bus"},
  {id:"itfaiye_arabasi",tr:"İtfaiye Arabası",en:"Fire Truck"},
  // Hayvanlar
  {id:"aslan",tr:"Aslan",en:"Lion"},
  {id:"kaplan",tr:"Kaplan",en:"Tiger"},
  {id:"kedi",tr:"Kedi",en:"Cat"},
  {id:"kopek",tr:"Köpek",en:"Dog"},
  {id:"inek",tr:"İnek",en:"Cow"},
  {id:"at",tr:"At",en:"Horse"},
  {id:"koyun",tr:"Koyun",en:"Sheep"},
  {id:"keci",tr:"Keçi",en:"Goat"},
  {id:"tavuk",tr:"Tavuk",en:"Chicken"},
  {id:"ordek",tr:"Ördek",en:"Duck"},
  {id:"kus",tr:"Kuş",en:"Bird"},
  {id:"tavsan",tr:"Tavşan",en:"Rabbit"},
  {id:"balik",tr:"Balık",en:"Fish"},
  {id:"fil",tr:"Fil",en:"Elephant"},
  {id:"ayi",tr:"Ayı",en:"Bear"},
  {id:"maymun",tr:"Maymun",en:"Monkey"},
  {id:"kurbaga",tr:"Kurbağa",en:"Frog"},
  {id:"kaplumbaga",tr:"Kaplumbağa",en:"Turtle"},
  {id:"domuz",tr:"Domuz",en:"Pig"},
  {id:"yunus",tr:"Yunus",en:"Dolphin"},
];

/* Elemanlar */
const instructionLine3 = document.getElementById("line3");

const optionLeft   = document.getElementById("optionLeft");
const optionCenter = document.getElementById("optionCenter");
const optionRight  = document.getElementById("optionRight");

const leftImg   = document.getElementById("leftImg");
const centerImg = document.getElementById("centerImg");
const rightImg  = document.getElementById("rightImg");

const leftTr   = document.getElementById("leftTr");
const centerTr = document.getElementById("centerTr");
const rightTr  = document.getElementById("rightTr");

const leftEn   = document.getElementById("leftEn");
const centerEn = document.getElementById("centerEn");
const rightEn  = document.getElementById("rightEn");

const dragCard = document.getElementById("dragCard");
const dragImg  = document.getElementById("dragImg");
const dragTr   = document.getElementById("dragTr");
const dragEn   = document.getElementById("dragEn");

/* Sembol bar & Tahta */
const barSlots = [...document.querySelectorAll('#symbolBar .bar-slot')];
const boardSlots = [...document.querySelectorAll('#symbolBoard .slot')];
const flyStar = document.getElementById("flyStar");

/* Sesler */
const praiseSounds = [
  new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_bf4d03054b.mp3"),
  new Audio("https://cdn.pixabay.com/download/audio/2021/08/04/audio_2f19d9df1b.mp3"),
  new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_dfae32b888.mp3"),
  new Audio("https://cdn.pixabay.com/download/audio/2021/09/13/audio_9b4c10d803.mp3")
];
const wrongSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_21cda77a64.mp3");

/* Durumlar */
let current=null, wrongA=null, wrongB=null, attempt=1;
let collectedOnBoard=0, countingMode=false, counted=0;

/* Yardımcılar */
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function randomItem(){return ITEMS[Math.floor(Math.random()*ITEMS.length)];}
function toAccusative(word){
  const lower=word.toLowerCase("tr");
  const lastVowel=(lower.match(/[aıoueöü]/g)||["a"]).slice(-1)[0];
  let ek="ı"; if(["e","i","ö","ü"].includes(lastVowel)) ek="i";
  if(["o","u"].includes(lastVowel)) ek="u"; if(["a","ı"].includes(lastVowel)) ek="ı";
  if(["ö","ü"].includes(lastVowel)) ek="ü";
  const last=lower.slice(-1); const vowels="aıoueiöü"; const isV=vowels.includes(last);
  if(isV) return word+"y"+ek;
  if(last==="k" && (ek==="i"||ek==="ü")) return word.slice(0,-1)+"ğ"+ek;
  return word+ek;
}

/* Yönerge güncelle */
function updateInstruction(){
  instructionLine3.textContent = "- " + toAccusative(current.tr).toUpperCase() + " EŞLE";
}

/* Kart içerik set et */
function setOption(trEl,imgEl,enEl,item){
  trEl.textContent=item.tr.toUpperCase();
  imgEl.src=`./assets/${item.id}.png`;
  imgEl.dataset.id=item.id;
  enEl.textContent=item.en.toLowerCase();
}

/* Ekranı doldur */
function renderQuestion(){
  updateInstruction();
  const arr=shuffle([current,wrongA,wrongB]);
  setOption(leftTr,leftImg,leftEn,arr[0]);
  setOption(centerTr,centerImg,centerEn,arr[1]);
  setOption(rightTr,rightImg,rightEn,arr[2]);

  dragTr.textContent=current.tr.toUpperCase();
  dragImg.src=`./assets/${current.id}.png`;
  dragEn.textContent=current.en.toLowerCase();

  resetDragPosition();
}

/* Yeni set */
function loadNew(){
  current=randomItem();
  do{wrongA=randomItem();}while(wrongA.id===current.id);
  do{wrongB=randomItem();}while(wrongB.id===current.id||wrongB.id===wrongA.id);
  attempt=1; renderQuestion();
}

/* Drag: pozisyon reset */
function resetDragPosition(){
  dragCard.style.transition="all .25s ease";
  dragCard.style.left="50%"; dragCard.style.top="";
  dragCard.style.bottom="7%"; dragCard.style.transform="translateX(-50%)";
}

/* Drag olayları */
let isDragging=false, startX=0, startY=0, startLeft=0, startTop=0;
dragCard.addEventListener("mousedown",dragStart);
dragCard.addEventListener("touchstart",dragStart,{passive:false});

function dragStart(e){
  e.preventDefault(); isDragging=true;
  const p=e.touches?e.touches[0]:e;
  startX=p.clientX; startY=p.clientY;
  const r=dragCard.getBoundingClientRect(); startLeft=r.left; startTop=r.top;
  dragCard.style.transition="none"; dragCard.style.cursor="grabbing";
  document.addEventListener("mousemove",dragging);
  document.addEventListener("touchmove",dragging,{passive:false});
  document.addEventListener("mouseup",dragEnd);
  document.addEventListener("touchend",dragEnd);
}
function dragging(e){
  if(!isDragging) return;
  const p=e.touches?e.touches[0]:e;
  const dx=p.clientX-startX; const dy=p.clientY-startY;
  dragCard.style.left=(startLeft+dx)+"px";
  dragCard.style.top=(startTop+dy)+"px";
  dragCard.style.transform="none";
}
function dragEnd(){
  if(!isDragging) return; isDragging=false; dragCard.style.cursor="grab";
  document.removeEventListener("mousemove",dragging);
  document.removeEventListener("touchmove",dragging);
  document.removeEventListener("mouseup",dragEnd);
  document.removeEventListener("touchend",dragEnd);

  const d=dragCard.getBoundingClientRect();
  const targets=[
    {el:optionLeft,  id:leftImg.dataset.id},
    {el:optionCenter,id:centerImg.dataset.id},
    {el:optionRight, id:rightImg.dataset.id},
  ];
  let hitId=null;
  targets.forEach(t=>{
    const r=t.el.getBoundingClientRect();
    const hit=!(d.right<r.left||d.left>r.right||d.bottom<r.top||d.top>r.bottom);
    if(hit) hitId=t.id;
  });

  if(hitId){
    if(hitId===current.id) handleCorrect();
    else handleWrong();
  }else{
    resetDragPosition();
  }
}

/* Doğru / Yanlış */
function handleCorrect(){
  dragCard.classList.add("correct");
  // Aferin/Bravo/Süpersin/Harika random
  const snd=praiseSounds[Math.floor(Math.random()*praiseSounds.length)];
  try{ snd.currentTime=0; snd.play(); }catch(e){}

  gainSymbol();

  // 2 denemeli akış: ilk doğruysa üstteki seçenekleri karıştırıp aynı nesneyi tekrar sor
  if(attempt===1){
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      shuffleTopOptions();
      attempt=2;
      resetDragPosition();
    },450);
  }else{
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      loadNew();
    },450);
  }
}
function handleWrong(){
  dragCard.classList.add("wrong");
  try{ wrongSound.currentTime=0; wrongSound.play(); }catch(e){}
  setTimeout(()=>{ dragCard.classList.remove("wrong"); resetDragPosition(); },450);
}

/* Üst 3 kartı karıştır (içerik shuffle) */
function shuffleTopOptions(){
  const pack=[
    {img:leftImg,tr:leftTr,en:leftEn},
    {img:centerImg,tr:centerTr,en:centerEn},
    {img:rightImg,tr:rightTr,en:rightEn}
  ];
  const states=pack.map(p=>({src:p.img.src,id:p.img.dataset.id,tr:p.tr.textContent,en:p.en.textContent}));
  shuffle(states);
  for(let i=0;i<3;i++){
    pack[i].img.src=states[i].src; pack[i].img.dataset.id=states[i].id;
    pack[i].tr.textContent=states[i].tr; pack[i].en.textContent=states[i].en;
  }
}

/* ====== Sembol Sistemi (bar → tahta, sonra sayma) ====== */
function firstFilledBarIndex(){return barSlots.findIndex(s=>!s.classList.contains("empty"));}
function firstEmptyBarIndex(){return barSlots.findIndex(s=>s.classList.contains("empty"));}

function gainSymbol(){
  if(countingMode) return;
  // bar’dan soldaki dolu ilk yıldızı azalt
  const i=firstFilledBarIndex();
  if(i!==-1) barSlots[i].classList.add("empty");

  // uçan ⭐ animasyonu → tahtaya iniş
  flyStar.style.top="65%"; flyStar.style.left="50%";
  flyStar.style.opacity=1; flyStar.style.transform="translate(-50%,-50%) scale(1)";
  setTimeout(()=>{
    flyStar.style.top="82%"; flyStar.style.left="88%";
    flyStar.style.opacity=0; flyStar.style.transform="translate(-50%,-50%) scale(.3)";
  },80);

  // tahtaya ekle
  setTimeout(()=>{
    if(collectedOnBoard<8){
      boardSlots[collectedOnBoard].textContent="⭐";
      boardSlots[collectedOnBoard].classList.add("active");
      collectedOnBoard++;
      if(collectedOnBoard===8){
        // sayma modu başlasın
        setTimeout(()=>{ countingMode=true; counted=0; speakTR("Hadi sembolleri sayalım"); },400);
      }
    }
  },350);
}

/* Tahtada sayma: tıklanan yıldız bar’a geri döner, sayı seslendirilir */
boardSlots.forEach(slot=>{
  slot.addEventListener("click",()=>{
    if(!countingMode) return;
    if(!slot.classList.contains("active")) return;

    slot.classList.remove("active");
    slot.textContent="";
    collectedOnBoard--;
    counted++;

    const nums=["bir","iki","üç","dört","beş","altı","yedi","sekiz"];
    speakTR(nums[counted-1]);

    const j=firstEmptyBarIndex();
    if(j!==-1) barSlots[j].classList.remove("empty");

    if(counted===8){
      setTimeout(()=>{
        speakTR("Aferin! Tüm sembolleri topladın");
        // sıfırla
        countingMode=false; counted=0; collectedOnBoard=0;
        // tahta zaten boş, bar full doldu
      },500);
    }
  });
});

/* Konuşma (tarayıcı TTS) */
function speakTR(t){
  if(!("speechSynthesis" in window)) return;
  const u=new SpeechSynthesisUtterance(t); u.lang="tr-TR"; speechSynthesis.speak(u);
}

/* Başlat */
window.addEventListener("load", ()=>{
  // bar’ı full dolu başlat
  barSlots.forEach(s=>s.classList.remove("empty"));
  loadNew();
});
</script>
</body>
</html>
