<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Pika & Berk ‚Äì V23.3 (Full ‚Ä¢ Ses + biber.png)</title>

<style>
:root{ --card-w:170px; --card-h:220px; }
*{ box-sizing:border-box; }
body{
  margin:0; height:100vh; overflow:hidden;
  background:linear-gradient(to bottom right,#b3e5fc,#e1f5fe);
  font-family:"Comic Sans MS",system-ui,sans-serif;
}

/* Y√∂nerge kutusu (sol √ºst) */
#instructionBox{
  position:absolute; top:40px; left:40px;
  background:#e3f2fd; border:3px solid #2196f3; border-radius:14px;
  padding:10px 14px; box-shadow:0 3px 8px rgba(0,0,0,.12);
  z-index:20; min-width:240px; color:#0d47a1;
}
#instructionBox .title{font-weight:700; margin-bottom:4px;}
#instructionBox .line{font-weight:700; font-size:13px; text-transform:uppercase; margin:1px 0;}

/* √ústteki 3 se√ßenek kart (biraz yukarƒ± ve yakƒ±n) */
.option-card{
  width:var(--card-w); height:var(--card-h);
  background:#fff; border:3px solid rgba(11,132,165,.4); border-radius:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
  position:absolute; display:flex; flex-direction:column; align-items:center;
  padding:6px 8px; user-select:none; z-index:10;
  transition:transform .25s ease, border-color .2s ease, box-shadow .2s ease;
}
#optionLeft{   top:6%; left:24%;}
#optionCenter{ top:6%; left:50%; transform:translateX(-50%);}
#optionRight{  top:6%; right:24%;}

.card-tr{ margin-top:2px; font-weight:800; text-transform:uppercase; text-align:center; font-size:14px;}
.card-img{ width:120px; height:120px; object-fit:contain; margin:6px 0; pointer-events:none;}
.card-en{ font-size:12px; font-style:italic; text-align:center; opacity:.85; margin-bottom:2px;}

/* Alt, s√ºr√ºklenen kart (biraz a≈üaƒüƒ±) */
#dragCard{
  width:var(--card-w); height:var(--card-h);
  background:#fff; border:3px solid rgba(11,132,165,.6); border-radius:16px;
  box-shadow:0 6px 10px rgba(0,0,0,.35);
  position:absolute; bottom:7%; left:50%; transform:translateX(-50%);
  display:flex; flex-direction:column; align-items:center;
  padding:6px 8px; cursor:grab; user-select:none; touch-action:none; z-index:200;
  transition:box-shadow .15s ease, border-color .15s ease;
}
.correct{ border-color:#2ecc71!important; box-shadow:0 0 18px rgba(46,204,113,.9)!important;}
.wrong{   border-color:#e74c3c!important; box-shadow:0 0 18px rgba(231,76,60,.9)!important;}

/* Sembol bar (en alta yakƒ±n) */
#symbolBar{
  position:absolute; bottom:2%; left:50%; transform:translateX(-50%);
  display:flex; gap:6px; background:rgba(255,255,255,.6);
  padding:6px 10px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.15); z-index:120;
}
.bar-slot{
  width:22px; height:22px; border-radius:6px; display:flex; align-items:center; justify-content:center;
  font-size:16px; background:#fff; transition:opacity .25s ease, transform .25s ease;
}
.bar-slot.empty{ opacity:.25; transform:scale(.9);}

/* Saƒü alttaki sembol tahtasƒ± */
#symbolBoard{
  position:absolute; bottom:20px; right:20px; width:270px; height:120px;
  background:url('https://cdn.pixabay.com/photo/2014/04/02/10/56/wood-306955_1280.png') center/cover no-repeat;
  border-radius:16px; display:flex; flex-wrap:wrap; justify-content:center; align-items:center;
  gap:6px; padding:10px; box-shadow:0 4px 10px rgba(0,0,0,.25);
}
.slot{
  width:30px; height:30px; border-radius:8px; background:rgba(255,255,255,.25);
  text-align:center; line-height:30px; font-size:22px; opacity:.25; transition:all .25s ease; cursor:pointer;
}
.slot.active{ opacity:1; transform:scale(1.06);}

/* U√ßan sembol */
#flyStar{
  position:absolute; width:40px; height:40px; background:gold; border-radius:50%;
  box-shadow:0 0 12px rgba(255,215,0,.9); top:50%; left:50%;
  transform:translate(-50%,-50%) scale(0); opacity:0; pointer-events:none; z-index:999; transition:all .35s ease;
}

/* Ses kilidi butonu (iOS/Android autoplay i√ßin) */
#unlockAudio{
  position:fixed; inset:auto 20px 20px auto;
  background:#1976d2; color:#fff; border:0; border-radius:24px; padding:10px 14px;
  box-shadow:0 4px 12px rgba(0,0,0,.2); font-weight:700; cursor:pointer; z-index:1500;
}
#unlockAudio.hidden{ display:none; }
</style>
</head>
<body>

<!-- Y√∂nerge -->
<div id="instructionBox">
  <div class="title">Y√ñNERGE :</div>
  <div class="line">- E≈ûLE</div>
  <div class="line">- AYNI OLANI E≈ûLE</div>
  <div class="line" id="line3">- ELMAYI E≈ûLE</div>
</div>

<!-- √ústteki 3 se√ßenek -->
<div class="option-card" id="optionLeft">
  <div class="card-tr" id="leftTr"></div>
  <img class="card-img" id="leftImg" alt="">
  <div class="card-en" id="leftEn"></div>
</div>
<div class="option-card" id="optionCenter">
  <div class="card-tr" id="centerTr"></div>
  <img class="card-img" id="centerImg" alt="">
  <div class="card-en" id="centerEn"></div>
</div>
<div class="option-card" id="optionRight">
  <div class="card-tr" id="rightTr"></div>
  <img class="card-img" id="rightImg" alt="">
  <div class="card-en" id="rightEn"></div>
</div>

<!-- Alt s√ºr√ºklenen kart -->
<div id="dragCard">
  <div class="card-tr" id="dragTr"></div>
  <img class="card-img" id="dragImg" alt="">
  <div class="card-en" id="dragEn"></div>
</div>

<!-- Sembol bar -->
<div id="symbolBar">
  <div class="bar-slot" id="b1">‚≠ê</div><div class="bar-slot" id="b2">‚≠ê</div>
  <div class="bar-slot" id="b3">‚≠ê</div><div class="bar-slot" id="b4">‚≠ê</div>
  <div class="bar-slot" id="b5">‚≠ê</div><div class="bar-slot" id="b6">‚≠ê</div>
  <div class="bar-slot" id="b7">‚≠ê</div><div class="bar-slot" id="b8">‚≠ê</div>
</div>

<!-- Sembol tahtasƒ± -->
<div id="symbolBoard">
  <div class="slot" id="s1"></div><div class="slot" id="s2"></div><div class="slot" id="s3"></div><div class="slot" id="s4"></div>
  <div class="slot" id="s5"></div><div class="slot" id="s6"></div><div class="slot" id="s7"></div><div class="slot" id="s8"></div>
</div>

<!-- U√ßan ‚≠ê -->
<div id="flyStar"></div>

<!-- Ses kilidi butonu -->
<button id="unlockAudio">üîä Sesi A√ß</button>

<script>
/* =========================
   V23.3 ‚Äì FULL MEKANƒ∞KLER
   (G√∂rsel d√ºzen + Ses aktif + biber.png d√ºzeltildi)
   ========================= */

/* --- 50 NESNE (id = assets dosya adƒ±) --- */
/* biber g√∂rseli "biber.png" olarak d√ºzeltildi */
const ITEMS = [
  // Meyveler (10)
  {id:"elma",tr:"Elma",en:"Apple"},
  {id:"muz",tr:"Muz",en:"Banana"},
  {id:"armut",tr:"Armut",en:"Pear"},
  {id:"uzum",tr:"√úz√ºm",en:"Grapes"},
  {id:"ananas",tr:"Ananas",en:"Pineapple"},
  {id:"cilek",tr:"√áilek",en:"Strawberry"},
  {id:"karpuz",tr:"Karpuz",en:"Watermelon"},
  {id:"kavun",tr:"Kavun",en:"Melon"},
  {id:"portakal",tr:"Portakal",en:"Orange"},
  {id:"kivi",tr:"Kivi",en:"Kiwi"},
  // Sebzeler (10)
  {id:"domates",tr:"Domates",en:"Tomato"},
  {id:"salatalik",tr:"Salatalƒ±k",en:"Cucumber"},
  {id:"biber",tr:"Biber",en:"Pepper"},         // <‚Äî burada biber.png
  {id:"sarimsak",tr:"Sarƒ±msak",en:"Garlic"},
  {id:"sogan",tr:"Soƒüan",en:"Onion"},
  {id:"brokoli",tr:"Brokoli",en:"Broccoli"},
  {id:"havuc",tr:"Havu√ß",en:"Carrot"},
  {id:"lahana",tr:"Lahana",en:"Cabbage"},
  {id:"misir",tr:"Mƒ±sƒ±r",en:"Corn"},
  {id:"patlican",tr:"Patlƒ±can",en:"Eggplant"},
  // Ta≈üƒ±tlar (10)
  {id:"kamyon",tr:"Kamyon",en:"Truck"},
  {id:"araba",tr:"Araba",en:"Car"},
  {id:"motosiklet",tr:"Motosiklet",en:"Motorcycle"},
  {id:"bisiklet",tr:"Bisiklet",en:"Bicycle"},
  {id:"gemi",tr:"Gemi",en:"Ship"},
  {id:"helikopter",tr:"Helikopter",en:"Helicopter"},
  {id:"ucak",tr:"U√ßak",en:"Plane"},
  {id:"tren",tr:"Tren",en:"Train"},
  {id:"otobus",tr:"Otob√ºs",en:"Bus"},
  {id:"itfaiye_arabasi",tr:"ƒ∞tfaiye Arabasƒ±",en:"Fire Truck"},
  // Hayvanlar (20)
  {id:"aslan",tr:"Aslan",en:"Lion"},
  {id:"kaplan",tr:"Kaplan",en:"Tiger"},
  {id:"kedi",tr:"Kedi",en:"Cat"},
  {id:"kopek",tr:"K√∂pek",en:"Dog"},
  {id:"inek",tr:"ƒ∞nek",en:"Cow"},
  {id:"at",tr:"At",en:"Horse"},
  {id:"koyun",tr:"Koyun",en:"Sheep"},
  {id:"keci",tr:"Ke√ßi",en:"Goat"},
  {id:"tavuk",tr:"Tavuk",en:"Chicken"},
  {id:"ordek",tr:"√ñrdek",en:"Duck"},
  {id:"kus",tr:"Ku≈ü",en:"Bird"},
  {id:"tavsan",tr:"Tav≈üan",en:"Rabbit"},
  {id:"balik",tr:"Balƒ±k",en:"Fish"},
  {id:"fil",tr:"Fil",en:"Elephant"},
  {id:"ayi",tr:"Ayƒ±",en:"Bear"},
  {id:"maymun",tr:"Maymun",en:"Monkey"},
  {id:"kurbaga",tr:"Kurbaƒüa",en:"Frog"},
  {id:"kaplumbaga",tr:"Kaplumbaƒüa",en:"Turtle"},
  {id:"domuz",tr:"Domuz",en:"Pig"},
  {id:"yunus",tr:"Yunus",en:"Dolphin"},
];

/* Elemanlar */
const instructionLine3 = document.getElementById("line3");
const optionLeft   = document.getElementById("optionLeft");
const optionCenter = document.getElementById("optionCenter");
const optionRight  = document.getElementById("optionRight");
const leftImg   = document.getElementById("leftImg");
const centerImg = document.getElementById("centerImg");
const rightImg  = document.getElementById("rightImg");
const leftTr   = document.getElementById("leftTr");
const centerTr = document.getElementById("centerTr");
const rightTr  = document.getElementById("rightTr");
const leftEn   = document.getElementById("leftEn");
const centerEn = document.getElementById("centerEn");
const rightEn  = document.getElementById("rightEn");
const dragCard = document.getElementById("dragCard");
const dragImg  = document.getElementById("dragImg");
const dragTr   = document.getElementById("dragTr");
const dragEn   = document.getElementById("dragEn");
const barSlots   = [...document.querySelectorAll('#symbolBar .bar-slot')];
const boardSlots = [...document.querySelectorAll('#symbolBoard .slot')];
const flyStar    = document.getElementById("flyStar");
const unlockBtn  = document.getElementById("unlockAudio");

/* Sesler (preload + unlock) */
const praiseSounds = [
  new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_bf4d03054b.mp3"), // aferin
  new Audio("https://cdn.pixabay.com/download/audio/2021/08/04/audio_2f19d9df1b.mp3"), // bravo
  new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_dfae32b888.mp3"), // harika gidiyorsun
  new Audio("https://cdn.pixabay.com/download/audio/2021/09/13/audio_9b4c10d803.mp3")  // s√ºpersin
];
const wrongSound        = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_21cda77a64.mp3");
const allCollectedSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_8a468eab84.mp3");
[...praiseSounds, wrongSound, allCollectedSound].forEach(a=>{ try{ a.preload="auto"; a.load(); }catch(e){} });

let audioUnlocked = false;
unlockBtn.addEventListener("click",()=>{
  // kullanƒ±cƒ± etkile≈üimi ile ses izni
  try{
    praiseSounds[0].muted = true; praiseSounds[0].play().then(()=>{praiseSounds[0].pause(); praiseSounds[0].muted=false;});
    wrongSound.muted = true; wrongSound.play().then(()=>{wrongSound.pause(); wrongSound.muted=false;});
    allCollectedSound.muted = true; allCollectedSound.play().then(()=>{allCollectedSound.pause(); allCollectedSound.muted=false;});
  }catch(e){}
  audioUnlocked = true;
  unlockBtn.classList.add("hidden");
});

/* Durumlar */
let current=null, wrongA=null, wrongB=null, attempt=1;
let collectedOnBoard=0, countingMode=false, counted=0;

/* Yardƒ±mcƒ±lar */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
function randomItem(){ return ITEMS[Math.floor(Math.random()*ITEMS.length)]; }
function toAccusative(word){
  const lower=word.toLowerCase("tr");
  const vowels="aƒ±oue√∂√º";
  const lastVowel=(lower.match(/[aƒ±oue√∂√º]/g)||["a"]).slice(-1)[0];
  let ek="ƒ±"; if(["e","i","√∂","√º"].includes(lastVowel)) ek="i";
  if(["o","u"].includes(lastVowel)) ek="u"; if(["a","ƒ±"].includes(lastVowel)) ek="ƒ±";
  if(["√∂","√º"].includes(lastVowel)) ek="√º";
  const last=lower.slice(-1);
  const isV=vowels.includes(last);
  if(isV) return word+"y"+ek;
  if(last==="k" && (ek==="i"||ek==="√º")) return word.slice(0,-1)+"ƒü"+ek;
  return word+ek;
}

/* Y√∂nerge g√ºncelle */
function updateInstruction(){
  instructionLine3.textContent = "- " + toAccusative(current.tr).toUpperCase() + " E≈ûLE";
}

/* Kart i√ßerik set et */
function setOption(trEl,imgEl,enEl,item){
  trEl.textContent=item.tr.toUpperCase();
  imgEl.src=`./assets/${item.id}.png`;
  imgEl.dataset.id=item.id;
  enEl.textContent=item.en.toLowerCase();
}

/* Ekranƒ± doldur */
function renderQuestion(){
  updateInstruction();
  const arr=shuffle([current,wrongA,wrongB]);
  setOption(leftTr,leftImg,leftEn,arr[0]);
  setOption(centerTr,centerImg,centerEn,arr[1]);
  setOption(rightTr,rightImg,rightEn,arr[2]);

  dragTr.textContent=current.tr.toUpperCase();
  dragImg.src=`./assets/${current.id}.png`;
  dragEn.textContent=current.en.toLowerCase();

  resetDragPosition();
}

/* Yeni set */
function loadNew(){
  current=randomItem();
  do{ wrongA=randomItem(); }while(wrongA.id===current.id);
  do{ wrongB=randomItem(); }while(wrongB.id===current.id || wrongB.id===wrongA.id);
  attempt=1; renderQuestion();
}

/* Drag: pozisyon reset */
function resetDragPosition(){
  dragCard.style.transition="all .25s ease";
  dragCard.style.left="50%"; dragCard.style.top="";
  dragCard.style.bottom="7%"; dragCard.style.transform="translateX(-50%)";
}

/* Drag olaylarƒ± */
let isDragging=false, startX=0, startY=0, startLeft=0, startTop=0;
dragCard.addEventListener("mousedown",dragStart);
dragCard.addEventListener("touchstart",dragStart,{passive:false});

function dragStart(e){
  e.preventDefault(); isDragging=true;
  const p=e.touches?e.touches[0]:e;
  startX=p.clientX; startY=p.clientY;
  const r=dragCard.getBoundingClientRect(); startLeft=r.left; startTop=r.top;
  dragCard.style.transition="none"; dragCard.style.cursor="grabbing";
  document.addEventListener("mousemove",dragging);
  document.addEventListener("touchmove",dragging,{passive:false});
  document.addEventListener("mouseup",dragEnd);
  document.addEventListener("touchend",dragEnd);
}
function dragging(e){
  if(!isDragging) return;
  const p=e.touches?e.touches[0]:e;
  const dx=p.clientX-startX; const dy=p.clientY-startY;
  dragCard.style.left=(startLeft+dx)+"px";
  dragCard.style.top=(startTop+dy)+"px";
  dragCard.style.transform="none";
}
function dragEnd(){
  if(!isDragging) return; isDragging=false; dragCard.style.cursor="grab";
  document.removeEventListener("mousemove",dragging);
  document.removeEventListener("touchmove",dragging);
  document.removeEventListener("mouseup",dragEnd);
  document.removeEventListener("touchend",dragEnd);

  const d=dragCard.getBoundingClientRect();
  const targets=[
    {el:optionLeft,  id:leftImg.dataset.id},
    {el:optionCenter,id:centerImg.dataset.id},
    {el:optionRight, id:rightImg.dataset.id},
  ];
  let hitId=null;
  targets.forEach(t=>{
    const r=t.el.getBoundingClientRect();
    const hit=!(d.right<r.left||d.left>r.right||d.bottom<r.top||d.top>r.bottom);
    if(hit) hitId=t.id;
  });

  if(hitId){
    if(hitId===current.id) handleCorrect();
    else handleWrong();
  }else{
    resetDragPosition();
  }
}

/* Doƒüru / Yanlƒ±≈ü */
function handleCorrect(){
  dragCard.classList.add("correct");
  if(audioUnlocked){
    const snd=praiseSounds[Math.floor(Math.random()*praiseSounds.length)];
    try{ snd.currentTime=0; snd.play(); }catch(e){}
  }
  gainSymbol();

  // 2 denemeli akƒ±≈ü: ilk doƒüruysa √ºstteki se√ßenekleri karƒ±≈ütƒ±rƒ±p aynƒ± nesneyi tekrar sor
  if(attempt===1){
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      shuffleTopOptions();
      attempt=2;
      resetDragPosition();
    },450);
  }else{
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      loadNew();
    },450);
  }
}
function handleWrong(){
  dragCard.classList.add("wrong");
  if(audioUnlocked){ try{ wrongSound.currentTime=0; wrongSound.play(); }catch(e){} }
  setTimeout(()=>{ dragCard.classList.remove("wrong"); resetDragPosition(); },450);
}

/* √úst 3 kartƒ± karƒ±≈ütƒ±r (i√ßerik shuffle) */
function shuffleTopOptions(){
  const pack=[
    {img:leftImg,tr:leftTr,en:leftEn},
    {img:centerImg,tr:centerTr,en:centerEn},
    {img:rightImg,tr:rightTr,en:rightEn}
  ];
  const states=pack.map(p=>({src:p.img.src,id:p.img.dataset.id,tr:p.tr.textContent,en:p.en.textContent}));
  shuffle(states);
  for(let i=0;i<3;i++){
    pack[i].img.src=states[i].src; pack[i].img.dataset.id=states[i].id;
    pack[i].tr.textContent=states[i].tr; pack[i].en.textContent=states[i].en;
  }
}

/* ====== Sembol Sistemi (bar ‚Üí tahta, sonra sayma) ====== */
function firstFilledBarIndex(){return barSlots.findIndex(s=>!s.classList.contains("empty"));}
function firstEmptyBarIndex(){return barSlots.findIndex(s=>s.classList.contains("empty"));}

function gainSymbol(){
  if(countingMode) return;
  // bar‚Äôdan soldaki dolu ilk yƒ±ldƒ±zƒ± azalt
  const i=firstFilledBarIndex();
  if(i!==-1) barSlots[i].classList.add("empty");

  // u√ßan ‚≠ê animasyonu ‚Üí tahtaya ini≈ü
  flyStar.style.top="65%"; flyStar.style.left="50%";
  flyStar.style.opacity=1; flyStar.style.transform="translate(-50%,-50%) scale(1)";
  setTimeout(()=>{
    flyStar.style.top="82%"; flyStar.style.left="88%";
    flyStar.style.opacity=0; flyStar.style.transform="translate(-50%,-50%) scale(.3)";
  },80);

  // tahtaya ekle
  setTimeout(()=>{
    if(collectedOnBoard<8){
      boardSlots[collectedOnBoard].textContent="‚≠ê";
      boardSlots[collectedOnBoard].classList.add("active");
      collectedOnBoard++;
      if(collectedOnBoard===8){
        // sayma modu ba≈ülasƒ±n
        setTimeout(()=>{ countingMode=true; counted=0; speakTR("Hadi sembolleri sayalƒ±m"); },400);
      }
    }
  },350);
}

/* Tahtada sayma: tƒ±klanan yƒ±ldƒ±z bar‚Äôa geri d√∂ner, sayƒ± seslendirilir */
boardSlots.forEach(slot=>{
  slot.addEventListener("click",()=>{
    if(!countingMode) return;
    if(!slot.classList.contains("active")) return;

    slot.classList.remove("active");
    slot.textContent="";
    collectedOnBoard--;
    counted++;

    const nums=["bir","iki","√º√ß","d√∂rt","be≈ü","altƒ±","yedi","sekiz"];
    speakTR(nums[counted-1]);

    const j=firstEmptyBarIndex();
    if(j!==-1) barSlots[j].classList.remove("empty");

    if(counted===8){
      setTimeout(()=>{
        if(audioUnlocked){ try{ allCollectedSound.currentTime=0; allCollectedSound.play(); }catch(e){} }
        speakTR("Aferin! T√ºm sembolleri topladƒ±n");
        // sƒ±fƒ±rla
        countingMode=false; counted=0; collectedOnBoard=0;
        // tahta bo≈üaldƒ±; bar tamamen doldu
      },500);
    }
  });
});

/* Konu≈üma (tarayƒ±cƒ± TTS) */
function speakTR(t){
  if(!("speechSynthesis" in window)) return;
  const u=new SpeechSynthesisUtterance(t); u.lang="tr-TR";
  speechSynthesis.speak(u);
}

/* Ba≈ülat */
window.addEventListener("load", ()=>{
  barSlots.forEach(s=>s.classList.remove("empty")); // bar‚Äôƒ± full dolu ba≈ülat
  loadNew();
});
</script>
</body>
</html>
